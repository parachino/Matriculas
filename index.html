<html>
<head>
  <script type="text/javascript">
    let lastPlate = "";
    let scanning = false;

    function onscan(scandata) {
      const textarea = document.getElementById("plateLog");
      lastPlate = scandata;

      // A침adir matr칤cula al log
      textarea.value += scandata + "\n";

      // Mostrar la 칰ltima matr칤cula le칤da
      document.getElementById("lastPlateDisplay").innerText = "칔ltima matr칤cula: " + scandata;
    }

    function startscan(platefield) {
      window.location = "readplate://" + platefield;
    }

    function startScanningLoop() {
      if (scanning) return; // Evitar m칰ltiples bucles si se pulsa m치s de una vez
      scanning = true;

      function loop() {
        startscan('platefield1');
        setTimeout(loop, 500); // repetir cada 500 milisegundos
      }

      loop();
    }

    function saveToFile() {
      const content = document.getElementById("plateLog").value;
      const blob = new Blob([content], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "license_plates_log.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function copyLastPlate() {
      if (lastPlate === "") {
        alert("No hay matr칤cula escaneada a칰n.");
        return;
      }
      navigator.clipboard.writeText(lastPlate).then(() => {
        alert("칔ltima matr칤cula copiada al portapapeles.");
      });
    }

    function copyAllPlates() {
      const all = document.getElementById("plateLog").value;
      if (all.trim() === "") {
        alert("No hay matr칤culas escaneadas.");
        return;
      }
      navigator.clipboard.writeText(all).then(() => {
        alert("Todas las matr칤culas copiadas al portapapeles.");
      });
    }
  </script>
</head>

<body>
  <h3>Esc치ner de Matr칤culas</h3>

  <!-- Mostrar la 칰ltima matr칤cula escaneada -->
  <p id="lastPlateDisplay" style="font-weight: bold;">칔ltima matr칤cula: -</p>

  <!-- Botones para copiar -->
  <input onclick="copyLastPlate()" type="button" value="游늶 Copiar 칰ltima matr칤cula" />
  <input onclick="copyAllPlates()" type="button" value="游늶 Copiar todas las matr칤culas" /><br /><br />

  <!-- 츼rea donde se acumulan las matr칤culas -->
  <textarea id="plateLog" rows="10" cols="50" placeholder="Aqu칤 se ir치n listando las matr칤culas..."></textarea><br /><br />

  <input onclick="saveToFile()" type="button" value="Guardar archivo con matr칤culas" />

  <!-- Espaciado de 3 l칤neas -->
  <br /><br /><br />

  <!-- Bot칩n de escaneo en bucle -->
  <input onclick="startScanningLoop()" type="button" value="游대 Iniciar escaneo continuo de matr칤culas" />
</body>
</html>
