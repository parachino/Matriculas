<html>
<head>
  <script type="text/javascript">
    let lastPlate = ""; // Guardamos la √∫ltima matr√≠cula escaneada

    function onscan(scandata) {
      const textarea = document.getElementById("plateLog");
      lastPlate = scandata;

      // A√±adir matr√≠cula al log
      textarea.value += scandata + "\n";

      // Mostrar la √∫ltima matr√≠cula le√≠da
      document.getElementById("lastPlateDisplay").innerText = "√öltima matr√≠cula: " + scandata;

      alert("Matr√≠cula detectada: " + scandata);
    }

    function startscan(platefield) {
      window.location = "readplate://" + platefield;
    }

    function saveToFile() {
      const content = document.getElementById("plateLog").value;
      const blob = new Blob([content], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "license_plates_log.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function copyLastPlate() {
      if (lastPlate === "") {
        alert("No hay matr√≠cula escaneada a√∫n.");
        return;
      }
      navigator.clipboard.writeText(lastPlate).then(() => {
        alert("√öltima matr√≠cula copiada al portapapeles.");
      });
    }

    function copyAllPlates() {
      const all = document.getElementById("plateLog").value;
      if (all.trim() === "") {
        alert("No hay matr√≠culas escaneadas.");
        return;
      }
      navigator.clipboard.writeText(all).then(() => {
        alert("Todas las matr√≠culas copiadas al portapapeles.");
      });
    }
  </script>
</head>

<body>
  <h3>Esc√°ner de Matr√≠culas</h3>

  <input onclick="startscan('platefield1')" type="button" value="Escanear matr√≠cula" /><br /><br />

  <!-- Mostrar la √∫ltima matr√≠cula escaneada -->
  <p id="lastPlateDisplay" style="font-weight: bold;">√öltima matr√≠cula: -</p>

  <!-- Botones para copiar -->
  <input onclick="copyLastPlate()" type="button" value="üìã Copiar √∫ltima matr√≠cula" />
  <input onclick="copyAllPlates()" type="button" value="üìã Copiar todas las matr√≠culas" /><br /><br />

  <!-- √Årea donde se acumulan las matr√≠culas -->
  <textarea id="plateLog" rows="10" cols="50" placeholder="Aqu√≠ se ir√°n listando las matr√≠culas..."></textarea><br /><br />

  <input onclick="saveToFile()" type="button" value="Guardar archivo con matr√≠culas" />
</body>
</html>
